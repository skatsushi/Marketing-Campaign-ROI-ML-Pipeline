# 広告チャネルごとの費用と収益の関係を予測する機械学習モデルAPI運用のためのMLパイプライン

このプロジェクトは、広告チャネル（検索エンジン、ソーシャルメディア、動画、Eメール）ごとの費用と収益の関係を予測する機械学習モデルの運用パイプラインをGoogle Cloud Platform (GCP)上で構築するためのものです。以下に、全体的なワークフローを説明します。

## ワークフロー概要

![Workflow](image/Airflow.png)

### 1. データ収集

- 広告チャネルごとの費用データと月次収益データを収集し、Google Cloud Storage (GCS) に保存します。

### 2. モデルの定期的な再トレーニングと最新モデルのデリバリー (GCP Composer - Airflow)

- **毎日のスケジュール実行**: Airflowを使用して、以下のタスクを毎日定時に自動実行します。
  - **データ検証**: 入力データの整合性を確認し、問題があればアラートを生成します。
  - **モデルのトレーニング**: multiple linear regressionを用いて、広告費用と収益の関係を学習します。
  - **モデルの評価**: トレーニングされたモデルの性能を評価し、精度やR2スコアを計算します。
  - **成果物のGCSへのデプロイ**: トレーニング済みモデルを`.joblib`ファイルとしてGCSにデプロイします。
- **自動メールアラート**: タスクが失敗した場合、自動的にメールでアラートを送信します。

### 3. CI/CDプロセスの設定 (GCP Cloud Build)

- **ユニットテストの実行**: PyTestを使用して、モデルのトレーニングスクリプトのユニットテストを実行します。
- **ソースコードのバージョン管理**: GitHubリポジトリを作成し、ソースコードのバージョン管理を行います。
- **ビルド、テスト、デプロイの自動化**: Cloud Buildを使用して、コードのビルド、テスト、およびデプロイを自動化します。
- **Cloud Build トリガー**: GitHubリポジトリに新しい変更がコミットされるたびに、自動でビルド、テスト、デプロイが実行されます。

### 4. モデル推論APIのデプロイ (GCP Cloud Run)

- **Flaskアプリケーションのデプロイ**: Flaskで開発したモデル推論APIをGoogle Cloud Runにデプロイします。これにより、スケーラブルで高可用性のアプリケーションとして提供します。
  - APIは広告チャネルごとの月次の費用データをJSON形式で受け取り、予測されたROIを返します。

## 使用技術

- **Google Cloud Platform (GCP)**
  - Google Cloud Storage (GCS)
  - Cloud Composer (Airflow)
  - Cloud Build
  - Cloud Run
- **Python**
  - Flask
  - scikit-learn
  - PyTest

